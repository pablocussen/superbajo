import React, { useState, useEffect, useCallback, useRef } from 'react'; import { Music, Volume2, Play, Pause, RotateCcw, Star, Heart, Mic, Trophy, Github, Smartphone } from 'lucide-react'; // Crear contexto de audio Web Audio API let audioContext; let masterGainNode; let analyserNode; const initAudioContext = () => { if (!audioContext) { audioContext = new (window.AudioContext || window.webkitAudioContext)(); masterGainNode = audioContext.createGain(); analyserNode = audioContext.createAnalyser(); masterGainNode.connect(analyserNode); analyserNode.connect(audioContext.destination); masterGainNode.gain.value = 0.3; analyserNode.fftSize = 2048; } return audioContext; }; const BassGuitarApp = () => { const [currentLesson, setCurrentLesson] = useState(0); const [isPlaying, setIsPlaying] = useState(false); const [score, setScore] = useState(0); const [activeString, setActiveString] = useState(null); const [showNotes, setShowNotes] = useState(true); const [hearts, setHearts] = useState([]); const [isListening, setIsListening] = useState(false); const [detectedNote, setDetectedNote] = useState(''); const [streak, setStreak] = useState(0); const [achievements, setAchievements] = useState([]); const [showPrize, setShowPrize] = useState(''); const streamRef = useRef(null); const animationRef = useRef(null); // Notas del bajo (afinación estándar EADG) con más octavas const bassNotes = { 1: { note: 'G', freq: 98, color: '#FF6B9D', name: 'Sol' }, 2: { note: 'D', freq: 73.42, color: '#4ECDC4', name: 'Re' }, 3: { note: 'A', freq: 55, color: '#FFE66D', name: 'La' }, 4: { note: 'E', freq: 41.2, color: '#A8E6CF', name: 'Mi' } }; // Progresión inspirada en estilos pop/rock (no específicamente Yellow para evitar copyright) const inspiredSong = [ { string: 4, duration: 800, note: 'Mi' }, // E { string: 3, duration: 800, note: 'La' }, // A { string: 2, duration: 800, note: 'Re' }, // D { string: 1, duration: 800, note: 'Sol' }, // G { string: 4, duration: 400, note: 'Mi' }, // E { string: 3, duration: 400, note: 'La' }, // A { string: 2, duration: 1200, note: 'Re' }, // D ]; const lessons = [ { title: "¡Conoce tu Bajo! 🎸", description: "Haz clic en cada cuerda para escuchar su sonido", target: null, instructions: "Las cuerdas del bajo son: Mi (E), La (A), Re (D), Sol (G)", emoji: "🎵" }, { title: "Toca la cuerda Mi (E) 🌟", description: "Encuentra y toca la cuerda más gruesa", target: 4, instructions: "La cuerda Mi es la más grave y gruesa del bajo", emoji: "💫" }, { title: "Toca la cuerda Sol (G) ⭐", description: "Encuentra y toca la cuerda más aguda", target: 1, instructions: "La cuerda Sol es la más aguda y delgada del bajo", emoji: "🌈" }, { title: "Practica la progresión 🎯", description: "Sigue la secuencia: Mi-La-Re-Sol", target: 'sequence', instructions: "¡Toca las cuerdas en el orden correcto!", emoji: "🎊" } ]; const prizes = [ "¡Estrella Dorada! 🌟", "¡Corazón Musical! 💖", "¡Rayo de Música! ⚡", "¡Nota Perfecta! 🎵", "¡Bajo Maestro! 🏆", "¡Arcoíris Musical! 🌈" ]; const createHearts = useCallback((x, y) => { const newHearts = []; for (let i = 0; i < 5; i++) { newHearts.push({ id: Date.now() + i, x: x + (Math.random() - 0.5) * 100, y: y, emoji: ['💖', '💝', '💕', '💗', '🎵', '⭐'][Math.floor(Math.random() * 6)] }); } setHearts(prev => [...prev, ...newHearts]); setTimeout(() => { setHearts(prev => prev.filter(heart => !newHearts.some(newHeart => newHeart.id === heart.id))); }, 2000); }, []); const showPrizeAnimation = (prize) => { setShowPrize(prize); setTimeout(() => setShowPrize(''), 3000); }; const getFrequencyFromAudio = (dataArray, sampleRate) => { const nyquist = sampleRate / 2; const fundamentalFreq = nyquist / dataArray.length; let maxIndex = 0; let maxValue = 0; for (let i = 1; i < dataArray.length / 2; i++) { if (dataArray[i] > maxValue) { maxValue = dataArray[i]; maxIndex = i; } } return maxIndex * fundamentalFreq; }; const detectNote = (frequency) => { const notes = [ { name: 'Mi', freq: 41.2, tolerance: 5 }, { name: 'La', freq: 55, tolerance: 5 }, { name: 'Re', freq: 73.42, tolerance: 5 }, { name: 'Sol', freq: 98, tolerance: 5 } ]; for (let note of notes) { if (Math.abs(frequency - note.freq) < note.tolerance) { return note.name; } } return null; }; const startListening = async () => { try { const ctx = initAudioContext(); const stream = await navigator.mediaDevices.getUserMedia({ audio: true }); streamRef.current = stream; const source = ctx.createMediaStreamSource(stream); source.connect(analyserNode); setIsListening(true); const dataArray = new Uint8Array(analyserNode.frequencyBinCount); const analyze = () => { analyserNode.getByteFrequencyData(dataArray); const frequency = getFrequencyFromAudio(dataArray, ctx.sampleRate); const note = detectNote(frequency); if (note) { setDetectedNote(note); if (lessons[currentLesson].target && bassNotes[lessons[currentLesson].target]?.name === note) { setScore(prev => prev + 20); setStreak(prev => prev + 1); createHearts(300, 200); if (streak > 0 && streak % 3 === 0) { const prize = prizes[Math.floor(Math.random() * prizes.length)]; showPrizeAnimation(prize); setAchievements(prev => [...prev, prize]); } } } if (isListening) { animationRef.current = requestAnimationFrame(analyze); } }; analyze(); } catch (error) { console.error('Error accessing microphone:', error); alert('No se pudo acceder al micrófono. Asegúrate de dar permisos.'); } }; const stopListening = () => { setIsListening(false); if (streamRef.current) { streamRef.current.getTracks().forEach(track => track.stop()); } if (animationRef.current) { cancelAnimationFrame(animationRef.current); } setDetectedNote(''); }; useEffect(() => { return () => { if (streamRef.current) { streamRef.current.getTracks().forEach(track => track.stop()); } if (animationRef.current) { cancelAnimationFrame(animationRef.current); } }; }, []); const playNote = useCallback((stringNum, event) => { const ctx = initAudioContext(); if (ctx.state === 'suspended') { ctx.resume(); } const { freq } = bassNotes[stringNum]; const oscillator = ctx.createOscillator(); const gainNode = ctx.createGain(); oscillator.connect(gainNode); gainNode.connect(masterGainNode); oscillator.frequency.setValueAtTime(freq, ctx.currentTime); oscillator.type = 'sawtooth'; gainNode.gain.setValueAtTime(0, ctx.currentTime); gainNode.gain.linearRampToValueAtTime(0.8, ctx.currentTime + 0.01); gainNode.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.1); gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1.5); oscillator.start(ctx.currentTime); oscillator.stop(ctx.currentTime + 1.5); setActiveString(stringNum); setTimeout(() => setActiveString(null), 200); // Crear corazones en la posición del clic if (event) { createHearts(event.clientX, event.clientY); } if (lessons[currentLesson].target === stringNum) { setScore(score + 10); setStreak(prev => prev + 1); if (currentLesson < lessons.length - 1) { setTimeout(() => setCurrentLesson(currentLesson + 1), 1000); } } }, [currentLesson, score, createHearts]); const playInspiredSong = () => { setIsPlaying(true); let index = 0; const playNext = () => { if (index < inspiredSong.length) { playNote(inspiredSong[index].string); index++; setTimeout(playNext, inspiredSong[index - 1]?.duration || 800); } else { setIsPlaying(false); setScore(prev => prev + 50); showPrizeAnimation("¡Canción Completada! 🎉"); } }; playNext(); }; const resetLesson = () => { setCurrentLesson(0); setScore(0); setStreak(0); setAchievements([]); }; return (
{/* Floating Hearts */} {hearts.map(heart => (
{heart.emoji}
))} {/* Prize Animation */} {showPrize && (
{showPrize}
)}
{/* Header */}
Bajo Eléctrico para Eloisa 💕
¡Aprende a tocar el bajo de manera súper divertida! 🎸

{/* GitHub & Mobile Info */}
¡Compartible en GitHub!
¡Funciona en tu celular!
{/* Stats */}
Puntos: {score} ⭐
Lección: {currentLesson + 1}/{lessons.length}
Racha: {streak} 🔥
{detectedNote && (
Detecté: {detectedNote} 🎵
)}
{/* Lesson Info */}
{lessons[currentLesson].title}
{lessons[currentLesson].description}

{lessons[currentLesson].instructions}

{/* Microphone Control */}
{isListening ? '🔴 Parar Detección' : '🎤 Detectar mi Bajo'}
{/* Bass Guitar */}
{/* Neck */}
{/* Frets */} {[...Array(5)].map((_, i) => (
))} {/* Strings */} {Object.entries(bassNotes).map(([stringNum, noteData]) => (
playNote(parseInt(stringNum), e)} > {/* String line */}
{/* Note label */} {showNotes && (
{noteData.name} ({noteData.note}) {detectedNote === noteData.name && ✓}
)}
))}
{/* Body */}
{/* Controls */}
{isPlaying ? : } {isPlaying ? 'Tocando... 🎵' : 'Canción Inspirada 🎶'} setShowNotes(!showNotes)} className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-2 font-bold" > {showNotes ? 'Ocultar Notas' : 'Mostrar Notas'} 👀 Reiniciar 🔄
{/* Achievements */} {achievements.length > 0 && (
¡Tus Logros! 🏆
{achievements.map((achievement, index) => ( {achievement} ))}
)} {/* Tips */}
💡 Consejos súper geniales para Eloisa:
• 🎸 Las cuerdas más gruesas producen sonidos más graves (bajos)
• ✨ Las cuerdas más delgadas producen sonidos más agudos
• 🎵 El bajo es la base rítmica de la música - ¡eres la estrella!
• 🎤 Usa el micrófono para que detecte las notas de tu bajo real
• 💖 Cada nota correcta te da corazones y puntos extras
• 🌟 ¡Practica todos los días y serás una bajista increíble!
{/* GitHub Instructions */}
Para papá: Compartir en GitHub 📱
• Crea un repositorio en GitHub con el código de esta aplicación

• Activa GitHub Pages en la configuración del repositorio

• ¡Eloisa podrá usar la app desde su celular con solo abrir el enlace!

• La detección de micrófono funciona perfecto en dispositivos móviles

); }; export default BassGuitarApp;
